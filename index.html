<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chia S·∫ª ∆Ø·ªõc M∆°</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        input, button { padding: 10px; margin: 5px; }
        .dream { margin: 10px 0; padding: 10px; border: 1px solid #ddd; text-align: left; display: flex; flex-direction: column; align-items: center; }
        .dream img { max-width: 200px; margin-top: 10px; border-radius: 10px; }
    </style>
</head>
<body>
    <h2>Chia s·∫ª ∆∞·ªõc m∆° c·ªßa b·∫°n</h2>
    <input type="text" id="dream" placeholder="Nh·∫≠p ∆∞·ªõc m∆° c·ªßa b·∫°n"><br>
    <input type="file" id="imageUpload" accept="image/*"><br>
    <button onclick="submitDream()">G·ª≠i ∆∞·ªõc m∆°</button>

    <h3>Danh s√°ch ∆∞·ªõc m∆°:</h3>
    <div id="dream-list"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
        import { getDatabase, ref, push, set, onChildAdded, remove } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-storage.js";

        // ‚úÖ Thay th√¥ng tin Firebase c·ªßa b·∫°n v√†o ƒë√¢y
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "chia-se-uoc-mo.firebaseapp.com",
            databaseURL: "https://chia-se-uoc-mo-default-rtdb.firebaseio.com/",
            projectId: "chia-se-uoc-mo",
            storageBucket: "chia-se-uoc-mo.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Kh·ªüi t·∫°o Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const storage = getStorage(app);

        // üìù G·ª≠i ∆∞·ªõc m∆° v√† ·∫£nh l√™n Firebase
        window.submitDream = async function() {
            let dreamText = document.getElementById("dream").value.trim();
            let fileInput = document.getElementById("imageUpload").files[0];

            if (!dreamText) {
                alert("H√£y nh·∫≠p n·ªôi dung ∆∞·ªõc m∆°!");
                return;
            }

            let newDreamRef = push(ref(database, "dreams"));
            let dreamData = { text: dreamText };

            // N·∫øu c√≥ ·∫£nh, t·∫£i l√™n Firebase Storage
            if (fileInput) {
                let imageRef = storageRef(storage, `dreams/${newDreamRef.key}`);
                await uploadBytes(imageRef, fileInput);
                let imageUrl = await getDownloadURL(imageRef);
                dreamData.image = imageUrl;
            }

            // L∆∞u v√†o Database
            await set(newDreamRef, dreamData);

            // Reset input
            document.getElementById("dream").value = "";
            document.getElementById("imageUpload").value = "";
        };

        // üìå Hi·ªÉn th·ªã d·ªØ li·ªáu t·ª´ Firebase Realtime Database
        const dreamList = document.getElementById("dream-list");
        onChildAdded(ref(database, "dreams"), (snapshot) => {
            let data = snapshot.val();
            let dreamId = snapshot.key;

            // T·∫°o ph·∫ßn t·ª≠ hi·ªÉn th·ªã ∆∞·ªõc m∆°
            let post = document.createElement("div");
            post.className = "dream";
            post.innerHTML = `
                <p>${data.text}</p>
                ${data.image ? `<img src="${data.image}" alt="H√¨nh ·∫£nh ∆∞·ªõc m∆°">` : ""}
                <button onclick="deleteDream('${dreamId}', this)">X√≥a</button>
            `;
            dreamList.appendChild(post);
        });

        // üóëÔ∏è H√†m x√≥a ∆∞·ªõc m∆°
        window.deleteDream = function(dreamId, button) {
            let confirmDelete = confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ∆∞·ªõc m∆° n√†y?");
            if (confirmDelete) {
                remove(ref(database, `dreams/${dreamId}`));
                button.parentElement.remove();
            }
        };
    </script>
</body>
</html>
